#!/usr/bin/python3

#############################################
## Eliminare i commenti per stampare tutto ##
#############################################

import sys

Npp = 5
Nbit = 11


def dadda_fun(vertical_table):
    max_l_col = 0
    for i in range(len(vertical_table)):
        l_col = len(vertical_table[i])
        if l_col > max_l_col:
            max_l_col = l_col
    #    print("len", i, ") ", l_col)
#    print("L max is: ", max_l_col)

    empty_col = []
    if not (vertical_table[-1] == empty_col):
        vertical_table.append(empty_col)

    for i in range(len(vertical_table) - 1):
        col = vertical_table[i]
        next_col = vertical_table[i + 1]
        if len(vertical_table[i]) == max_l_col:
            print("Adding an HA in col", i)
            col = vertical_table[i]
            A = col[-1]
            B = col[-2]
            s = int((A and (not B)) or (B and (not A)))
            c = int(A and B)
#            print("A =", A, "B =", B, "\nS =", s, "C =", c)

            col.remove(A)
            col.remove(B)
            col.append(s)
            next_col.append(c)

        elif len(vertical_table[i]) > max_l_col:
            print("Adding an FA in col", i)
            c_in = col[-1]
            A = col[-2]
            B = col[-3]
            s = int((not c_in and (not A) and B)
                    or (not c_in and A and (not B))
                    or (c_in and (not A) and (not B))
                    or (c_in and A and B))
            c = int((A and B)
                    or (c_in and A and (not B))
                    or (c_in and B and (not A)))

            col.remove(c_in)
            col.remove(A)
            col.remove(B)
            col.append(s)
            next_col.append(c)

#            print("Cin =", c_in, "A =", A, "B =", A, "\nS =", s, "C =", c)

    for i in range(Npp):
        for col in vertical_table:
            if i < len(col):
                if col[i] == 1:
                    print('1', end='')
                else:
                    print('0', end='')
            else:
                print(' ', end='')
        print()

    return vertical_table


# Binary to decimal function
def dec_to_bin(dec_num, length):
    return str(format(dec_num, f'0{length}b'))


# init values
partial_products = [[0] * Nbit for _ in range(Npp)]
signs = [0 for _ in range(Npp)]
pp_dec = sys.argv

if len(pp_dec) < 6:
    print("Error: required 5 partial product")
    exit(-1)

# partial product assignment (binary)
for pp in range(len(partial_products)):
    partial_products[pp] = [int(digit) for digit in dec_to_bin(int(pp_dec[pp + 1]), 11)]
    # print("pp[", pp, "]:", partial_products[pp])

# signs assignment
signs = [partial_products[0][0], partial_products[1][0], partial_products[2][0], partial_products[3][0],
         partial_products[4][0]]

# first partial product sign extension
partial_products[0] = [int(not (signs[0]))] + [signs[0]] + [signs[0]] + partial_products[0]

# partial products sign extension
for pp in range(len(partial_products) - 1):
    partial_products[pp + 1] = [1] + [signs[pp + 1]] + partial_products[pp + 1]

# for row in partial_products:
#    print()

# tree generation, weight positions

# diagonal disposition in matrix
matrix = [['x'] * (2 * Nbit) for _ in range(Npp)]
shift = Nbit - 1
first = 0

for row in range(Npp):
    if first:
        Start = Nbit + 1
    else:
        Start = Nbit + 2
    for col in range(Start, -1, -1):
        if first:
            index = shift + col - 1
        else:
            index = shift + col - 2
        matrix[row][index] = partial_products[row][col]
    shift -= 2
    first = 1

# print('for row in matrix:\n\tprint(row)\n')
# for row in matrix:
#    print(row)

# print('\n\nVertical table\n\n')
vertical_table = [[Npp] for _ in range(2 * Nbit)]
tmp_list = [0] * Npp
for i in range(2 * Nbit):
    c = 0
    for row in matrix:
        # print(c, ') Row[', i, '] is:', row[i])
        tmp_list[c] = row[i]
        c = c + 1
    # print('Tmp list is:', tmp_list)

    # print('\n\nVertical table was:', vertical_table)
    # print('Tmp_list at cycle', i, 'is:', tmp_list)
    vertical_table[i] = tmp_list.copy()
# print('Vertical table is:', vertical_table, end='\n\n')

#print('\n\n\n ')
#print(vertical_table)
#print('\n\n\n Delete x values \n')

for col in vertical_table:
    const_len_col = len(col)
    len_col = const_len_col
    i = 0
    # print('\nCol is:', col, '\n')
    while i < len_col:
        # print('col[', const_len_col + i - len_col, '] =', col[i])
        if col[i] == 'x':
            # print('Delete col. col:', end=' ')
            del col[i]
            len_col = len_col - 1
            # print(col)
        else:
            i = i + 1
    # print('Col without x is:', col)

# print('\n', vertical_table, '\n')

for i in range(Npp):
    for col in vertical_table:
        if i < len(col):
            if col[i] == 1:
                print('1', end='')
            else:
                print('0', end='')
        else:
            print(' ', end='')
    print()

for i in range(3):
    print("\n\nITERATION:", i)
    vertical_table = dadda_fun(vertical_table)

